<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ุญููุฉ ููุฉ ุฑูุถุงู | UGTE ISIMM</title>

    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="font-[Cairo] bg-gray-50 text-gray-800">
    <!-- ================= HEADER ================= -->
    <header class="bg-green-700 text-white sticky top-0 z-50 shadow">
      <div class="max-w-7xl mx-auto flex justify-between items-center p-4">
        <div class="flex items-center gap-3">
          <img src="logo.webp" alt="UGTE" class="h-10 w-auto" />
          <h1 class="text-xl md:text-2xl font-bold">
            ๐ ุญููุฉ ููุฉ ุฑูุถุงู โ UGTE ISIMM
          </h1>
        </div>
        <nav class="hidden md:flex gap-6 font-semibold">
          <a href="#stats">ุงููุถุนูุฉ</a>
          <a href="#materials">ุงูููุงุฏ</a>
          <a href="#donations">ุงูุชุจุฑุนุงุช ุงููุงููุฉ</a>
          <a href="#contribute">ููู ูููู ุงููุดุงุฑูุฉ ูุนูู</a>
          <a href="#contact">ุงูุชูุงุตู ูุนูุง</a>
        </nav>
      </div>
    </header>

    <!-- ุฒุฑ ุชุดุบูู/ุฅููุงู ุงูุตูุช (ุซุงุจุช ูู ุฃุณูู ุงููุณุงุฑ) -->
    <button
      id="audioToggleBtn"
      class="fixed bottom-5 left-5 bg-green-700 hover:bg-green-800 text-white px-5 py-2 rounded-full shadow-lg z-50 transition"
    >
      ๐ ุชุดุบูู ุงูุตูุช
    </button>

    <!-- ููู ุงูููุณููู -->
    <audio id="bgMusic" loop preload="auto">
      <source src="music.mp3" type="audio/mpeg" />
      ูุชุตูุญู ูุง ูุฏุนู ุชุดุบูู ุงูุตูุช.
    </audio>

    <!-- ================= HERO ================= -->
    <section class="bg-green-800 text-white text-center py-28 px-6">
      <h2 class="text-4xl md:text-5xl font-extrabold mb-6">
        ูุนูุง ููููู 50 ููุฉ ๐ค
      </h2>
      <h3 class="text-xl mb-6">ูุจุงุฏุฑุฉ ุทูุงุจูุฉ ุชุถุงูููุฉ</h3>

      <!-- ุงูุชุจุงุณ -->
      <p id="quote" class="text-2xl italic font-semibold max-w-3xl mx-auto"></p>

      <!-- ุงูุนุฏ ุงูุชูุงุฒูู -->
      <h3 class="text-lg mt-10">
        โณ ุงููุฏุฉ ุงููุชุจููุฉ ุนูู ููุงูุฉ ุงูุญููุฉ:
        <strong id="countdown" class="text-yellow-300"></strong>
      </h3>
    </section>

    <!-- ================= STATS SECTION ================= -->
    <section class="py-10 max-w-7xl mx-auto px-6">
      <h3 class="text-3xl font-bold mb-12 text-center">๐ ุงููุถุนูุฉ ุงูุญุงููุฉ</h3>

      <div class="grid md:grid-cols-4 gap-8 text-center">
        <!-- ุนุฏุฏ ุงููุชุจุฑุนูู ูู ุงููุณุท -->
        <div class="md:col-span-4 flex justify-center gap-4">
          <div class="bg-white p-6 rounded-2xl shadow w-full md:w-1/4">
            <p class="text-4xl font-extrabold text-green-700" id="donor-count">
              <span
                class="inline-block w-8 h-8 border-4 border-green-200 border-t-green-700 rounded-full animate-spin"
              ></span>
            </p>
            <p class="font-semibold">ุนุฏุฏ ุงููุชุจุฑุนูู</p>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow w-full md:w-1/4">
            <p
              class="text-4xl font-extrabold text-green-700"
              id="donation-count"
            >
              <span
                class="inline-block w-8 h-8 border-4 border-green-200 border-t-green-700 rounded-full animate-spin"
              ></span>
            </p>
            <p class="font-semibold">ุนุฏุฏ ุงูุชุจุฑุนุงุช</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ================= MATERIALS ================= -->
    <section id="materials" class="py-16 max-w-7xl mx-auto px-6">
      <h3 class="text-3xl font-bold mb-6 text-center">๐ฅซ ุงูููุงุฏ ุงููุชุจุฑุน ุจูุง</h3>

      <div
        class="grid md:grid-cols-3 gap-8 max-w-4xl mx-auto text-lg"
        id="donation-stats"
      >
        <div class="text-center p-4 col-span-3">
          <span
            class="inline-block w-12 h-12 border-4 border-green-200 border-t-green-700 rounded-full animate-spin"
          ></span>
          <p class="mt-2 text-gray-500">ุฌุงุฑู ุงูุชุญููู...</p>
        </div>
      </div>

      <p class="text-center mt-10 text-sm text-gray-500">
        ููููู ุงููุณุงููุฉ ุจูุง ูุชูุณุฑ ูู ูู ุงูููุงุฏ ุงูุณุงุจูุฉ.
      </p>
    </section>

    <!-- ================= MONEY DONATIONS ================= -->
    <section
      id="donations"
      class="py-16 max-w-4xl mx-auto px-6 bg-green-50 rounded-xl shadow-md mb-16"
    >
      <h3 class="text-3xl font-bold mb-6 text-center text-green-800">
        ๐ต ูู ุนูุฏูุง ูู ุชุจุฑุนุงุช ูุงููุฉุ
      </h3>

      <div
        class="bg-white p-10 rounded-xl shadow text-center text-green-700 font-bold text-5xl md:text-6xl"
        id="money-amount"
      >
        <span
          class="inline-block w-16 h-16 border-4 border-green-200 border-t-green-700 rounded-full animate-spin"
        ></span>
      </div>

      <p class="mt-6 text-center text-green-800 text-lg">
        ูููููู ุงูุชูุงุตู ูุนุงูุง ูุชุณูู ูุตู ุงุซูุงุก ุชุจุฑุนูู <br />
        ุดูุฑูุง ููู ูู ุณุงูู ูู ุฏุนู ุงูุญููุฉ. ุชุจุฑุนุงุชูู ูู ุณุจุจ ูุฌุงุญูุง ูุงุณุชูุฑุงุฑูุง ูู
        ุงูุนุทุงุก.
      </p>
    </section>

    <!-- ================= HOW TO CONTRIBUTE ================= -->
    <section
      id="contribute"
      class="py-16 max-w-7xl mx-auto px-6 bg-green-50 rounded-xl shadow-md mb-16"
    >
      <h3 class="text-3xl font-bold mb-10 text-center text-green-800">
        ๐ค ููู ุฃุณุงูู ูุนููุ
      </h3>

      <div class="grid md:grid-cols-3 gap-8 max-w-5xl mx-auto text-green-800">
        <!-- ูุฑุช ุงูุชุจุฑุน ุจุงูููุงุฏ -->
        <div
          class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition cursor-default"
        >
          <div class="text-4xl mb-4 text-center text-green-600">๐ฅซ</div>
          <h4 class="font-semibold text-center text-xl mb-2">
            ุงูุชุจุฑุน ุจุงูููุงุฏ ุงูุบุฐุงุฆูุฉ
          </h4>
          <p class="text-center">
            ุณุงูู ุจุงูุชุจุฑุน ุจุงูููุงุฏ ุงูุบุฐุงุฆูุฉ ูุญู ูุชูุงุฌุฏูู ุจุงููุนูุฏ.
          </p>
        </div>

        <!-- ูุฑุช ุงูุชุจุฑุน ุงููุงูู -->
        <div
          class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition cursor-default"
        >
          <div class="text-4xl mb-4 text-center text-green-600">๐ฐ</div>
          <h4 class="font-semibold text-center text-xl mb-2">ุงูุชุจุฑุน ุงููุงูู</h4>
          <p class="text-center">
            ููููู ุงูุชุจุฑุน ูุงูููุง ุนุจุฑ ุชุทุจูู <strong>D17</strong> ุนูู ุงูุฑูู
            28893766 ุจุนุฏ ุงูุชูุณูู ูุนูุง ูุงุณุชูุงู ูุตู ุงูุชุจุฑุน.
          </p>
        </div>

        <!-- ูุฑุช ูุดุฑ ุงููุนู -->
        <div
          class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition cursor-default"
        >
          <div class="text-4xl mb-4 text-center text-green-600">๐ฃ</div>
          <h4 class="font-semibold text-center text-xl mb-2">ูุดุงุฑูุฉ ุงูุญููุฉ</h4>
          <p class="text-center">
            ุดุงุฑู ุงูุญููุฉ ูุน ุฃุตุฏูุงุฆู ูุนุงุฆูุชู ูุฒูุงุฏุฉ ุงููุนู ูุงููุดุงุฑูุฉ.<br />ูุงูุฏุงู
            ุนูู ุงูุฎูุฑ ููุงุนูู
          </p>
        </div>
      </div>

      <!-- ุฑุณุงูุฉ ุชุญููุฒูุฉ ุชุญุช ุงููุฑูุช -->
      <div
        class="bg-green-100 p-6 rounded-xl shadow text-center text-green-900 font-semibold text-lg mt-12 max-w-md mx-auto"
      >
        ูุณุงููุชู ุชุตูุน ูุฑููุง ูุจูุฑูุง โค๏ธ
      </div>
    </section>

    <!-- ================= BOYCOTT WARNING ================= -->
    <section id="stats" class="py-10 max-w-7xl mx-auto px-6">
      <div
        class="max-w-md mx-auto mb-10 p-4 bg-red-100 border border-red-400 rounded-lg text-center"
      >
        <p class="text-red-700 font-bold text-lg mb-4">
          ูุฑุฌู ูููู ุจูุทู ุชุฌูุจ ุฌูุจ ุงูููุงุฏ ุงูููุงุทุนุฉ.
        </p>

        <!-- ุฒุฑ ูุฅุธูุงุฑ ุงูููุงุฏ ุงูููุงุทุนุฉ -->
        <button
          id="toggleBlockedBtn"
          class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md transition"
        >
          ุงุถุบุท ููุง ูุนุฑุถ ุฃูู ุงูููุงุฏ ุงูููุงุทุนุฉ
        </button>

        <!-- ูุงุฆูุฉ ุงูููุงุฏ ุงูููุงุทุนุฉ (ูุฎููุฉ ุจุดูู ุงูุชุฑุงุถู) -->
        <div
          id="blockedMaterials"
          class="mt-4 p-4 bg-red-50 border border-red-300 rounded-lg text-right text-red-700 font-semibold hidden max-w-md mx-auto"
        >
          <ul class="list-disc list-inside space-y-2">
            <li>ุงููุฑุฏุฉ ุงูุจูุถุงุก</li>
            <li>ุฏููุณ</li>
            <li>ุงูุณูุฏุฉ</li>
            <li>president</li>
            <li>sicam</li>
            <li>nestle</li>
            <li>ูุงุก ููููุชู</li>
            <li>ูุงุก ุตุงุจุฑูู</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ================= PALESTINE ================= -->
    <section
      id="palestine"
      class="bg-red-900 text-white py-12 px-6 max-w-7xl mx-auto rounded-xl shadow-lg my-16"
    >
      <h3 class="text-4xl font-bold mb-6 text-center">
        ูุง ุชูุณู ุงููุถูุฉ ุงูููุณุทูููุฉ
      </h3>

      <p class="text-center max-w-3xl mx-auto mb-6 text-lg leading-relaxed">
        ูุคูุฏ ุฏุนููุง ุงููุงูู ููู ุญุฑูุงุช ุงูููุงููุฉ ุงูููุณุทูููุฉ ูุนูู ุฑุฃุณูุง ุญุฑูุฉ ุงูููุงููุฉ
        ุงูุฅุณูุงููุฉ (ุญูุงุณ) ููู ูู ูุฏุงูุน ุนู ุงูุญู ุงูููุณุทููู ุถุฏ ูุฌู ุงูุงุญุชูุงู.
      </p>
      <p class="text-center max-w-3xl mx-auto mb-6 text-lg leading-relaxed">
        ูุง ุชูุณูุง ุงูุฏุนุงุก ูุฅุฎูุงููู
      </p>

      <div class="max-w-3xl mx-auto text-center mb-8">
        <p class="italic text-yellow-300 font-semibold text-xl">
          "ุงูููู ุงุญูุธ ุฃูู ุบุฒุฉ ูุฃููุฏ ุตููุฏููุ ูุงุฑุฒููู ุงููุตุฑ ูุงููุฑุฌ ุงููุฑูุจ."
        </p>
      </div>

      <!-- ุตูุฑ ุงูุฃุนูุงู ูุงูุดุนุงุฑุงุช -->
      <div class="flex justify-center gap-8 flex-wrap items-center">
        <!-- ุนูู ููุณุทูู -->
        <img
          src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Flag_of_Palestine.svg/320px-Flag_of_Palestine.svg.png"
          alt="ุนูู ููุณุทูู"
          class="h-32 rounded shadow-md p-2"
        />

        <!-- ุดุนุงุฑ ุญุฑูุฉ ุญูุงุณ -->
        <img
          src="https://iconape.com/wp-content/files/wz/386239/svg/386239.svg"
          alt="ุดุนุงุฑ ุญุฑูุฉ ุญูุงุณ"
          class="h-28 rounded shadow-md p-2"
        />

        <!-- ุดุนุงุฑ ุณุฑุงูุง ุงููุฏุณ -->
        <img
          src="https://www.bing.com/th/id/OIP.72T78uqi3aHghC3k1zkvdQHaHH?w=214&h=211&c=8&rs=1&qlt=90&o=6&dpr=2.5&pid=3.1&rm=2"
          alt="ุดุนุงุฑ ุณุฑุงูุง ุงููุฏุณ"
          class="h-28 rounded shadow-md p-2"
        />

        <!-- ุดุนุงุฑ ูุชุงุฆุจ ุนุฒ ุงูุฏูู ุงููุณุงู -->
        <img
          src="https://www.bing.com/th/id/OIP.rdD98iuzUDxXvglSqxVCfAHaHY?w=184&h=211&c=8&rs=1&qlt=90&o=6&dpr=2.5&pid=3.1&rm=2"
          alt="ุดุนุงุฑ ูุชุงุฆุจ ุนุฒ ุงูุฏูู ุงููุณุงู"
          class="h-28 rounded shadow-md p-2"
        />

        <!-- ุดุนุงุฑ ุญุฑูุฉ ุฌูุงุฏ ุงูุฅุณูุงู -->
        <img
          src="https://th.bing.com/th/id/OIP.ZX-pKGlRAO1bkQIdAFZ8SgHaHT?w=251&h=248&c=8&rs=1&qlt=90&o=6&dpr=2.5&pid=3.1&rm=2"
          alt="ุดุนุงุฑ ุญุฑูุฉ ุฌูุงุฏ ุงูุฅุณูุงู"
          class="h-28 rounded shadow-md p-2"
        />
      </div>
    </section>

    <!-- ================= CONTACT ================= -->
    <section id="contact" class="bg-green-700 text-white py-20">
      <div class="max-w-7xl mx-auto px-6 text-center">
        <h3 class="text-3xl font-bold mb-6">๐ ุชูุงุตู ูุนูุง</h3>
        <p class="text-xl mb-2">ุงููุงุชู / ูุงุชุณุงุจ: <strong>28893766</strong></p>
        <p class="text-xl mb-4">ููุณุจูู: <strong>UGTE ISIMM</strong></p>
        <p class="text-lg">ูููููู ุงูุชุจุฑุน ุนุจุฑ ุชุทุจูู D17 ุจุนุฏ ุงูุชูุงุตู ูุนูุง</p>
      </div>
    </section>

    <!-- ================= FOOTER ================= -->
    <footer class="bg-gray-900 text-gray-300 py-6 text-center">
      <p>ยฉ 2026 ุญููุฉ ููุฉ ุฑูุถุงู โ ุงูุงุชุญุงุฏ ุงูุนุงู ุงูุชููุณู ููุทูุจุฉ | ISIMM</p>
    </footer>

    <!-- ================= SCRIPTS ================= -->
    <script>
      // ุตูุช ุงูุฎูููุฉ
      const music = document.getElementById("bgMusic");
      const btn = document.getElementById("audioToggleBtn");
      music.volume = 0.35;

      btn.addEventListener("click", () => {
        if (music.paused) {
          music.play().catch(() => {});
          btn.innerText = "๐ ุฅููุงู ุงูุตูุช";
          btn.classList.replace("bg-green-700", "bg-gray-600");
        } else {
          music.pause();
          btn.innerText = "๐ ุชุดุบูู ุงูุตูุช";
          btn.classList.replace("bg-gray-600", "bg-green-700");
        }
      });

      // ุงูุชุจุงุณุงุช ูุชุบูุฑุฉ
      const quotes = [
        "ยซูุชุนุงูููุง ุนูู ุงูุจุฑ ูุงูุชูููยป",
        "ยซููุฉ ุตุบูุฑุฉุ ุฃุซุฑูุง ูุจูุฑยป",
        "ยซูู ุฑูุถุงูุ ุงูุชูุงูู ุนุจุงุฏุฉยป",
      ];

      let i = 0;
      const quoteEl = document.getElementById("quote");

      function changeQuote() {
        quoteEl.innerText = quotes[i % quotes.length];
        i++;
      }

      changeQuote();
      setInterval(changeQuote, 3000);

      // ุงูุนุฏ ุงูุชูุงุฒูู
      function updateCountdown() {
        const endDate = new Date("2026-02-09T23:59:59");
        const now = new Date();
        let diff = endDate - now;
        const el = document.getElementById("countdown");

        if (diff <= 0) {
          el.innerText = "ุงูุชูุช ุงูุญููุฉ ๐ค";
          return;
        }

        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        el.innerText = `${days} ููู`;
      }

      updateCountdown();
      setInterval(updateCountdown, 1000);

      // ุฒุฑ ุฅุธูุงุฑ ูุฅุฎูุงุก ุงูููุงุฏ ุงูููุงุทุนุฉ
      const toggleBtn = document.getElementById("toggleBlockedBtn");
      const blockedDiv = document.getElementById("blockedMaterials");

      toggleBtn.addEventListener("click", () => {
        blockedDiv.classList.toggle("hidden");
        if (blockedDiv.classList.contains("hidden")) {
          toggleBtn.innerText = "ุงุถุบุท ููุง ูุนุฑุถ ุฃูู ุงูููุงุฏ ุงูููุงุทุนุฉ";
        } else {
          toggleBtn.innerText = "ุฅุฎูุงุก ุงูููุงุฏ ุงูููุงุทุนุฉ";
        }
      });
    </script>

    <!-- ================= REALTIME DATA SCRIPT ================= -->
    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

      // ========================================
      // CONFIGURATION
      // ========================================
      const SUPABASE_URL = "https://hxwbbymzinxmtmfhyxdt.supabase.co";
      const SUPABASE_ANON_KEY =
        "sb_publishable_cUkHi6YR7FyK74vr1dCk4w_UojIyVYv";

      const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // ========================================
      // CHANNEL CONFIGURATION
      // ========================================
      // Each metric has its own dedicated channel
      const CHANNELS = {
        DONOR_COUNT: "realtime:donor_count",
        DONATION_COUNT: "realtime:donation_count",
        DONATION_STATS: "realtime:donation_stats",
        MONEY_AMOUNT: "realtime:money_amount",
      };

      // ========================================
      // 1. DONOR COUNT
      // ========================================
      async function loadDonorCount() {
        const dc = document.getElementById("donor-count");

        try {
          // Load initial data
          const { data, error } = await supabase.rpc("get_donor_count");
          if (error) throw error;

          dc.textContent = data.donor_count || 0;
          console.log("โ [DONOR] Initialized:", data);

          // Subscribe to dedicated channel
          supabase
            .channel(CHANNELS.DONOR_COUNT)
            .on("broadcast", { event: "donor_count_updated" }, (payload) => {
              console.log("๐ [DONOR] Update received!");
              const data = payload.payload;

              if (data && data.donor_count !== undefined) {
                dc.textContent = data.donor_count;
                console.log(`โ [DONOR] Updated to: ${data.donor_count}`);
              } else {
                console.error("โ [DONOR] Invalid payload:", payload);
              }
            })
            .subscribe((status) => {
              console.log(`๐ก [DONOR] Subscription: ${status}`);
            });
        } catch (err) {
          console.error("โ [DONOR] Failed to load:", err);
          dc.textContent = "Error";
        }
      }

      // ========================================
      // 2. DONATION COUNT
      // ========================================
      async function loadDonationCount() {
        const dc = document.getElementById("donation-count");

        try {
          // Load initial data
          const { data, error } = await supabase.rpc("get_donation_count");
          if (error) throw error;

          dc.textContent = data || 0;
          console.log("โ [DONATION COUNT] Initialized:", data);

          // Subscribe to dedicated channel
          supabase
            .channel(CHANNELS.DONATION_COUNT)
            .on("broadcast", { event: "donation_count_updated" }, (payload) => {
              console.log("๐ [DONATION COUNT] Update received!");
              const data = payload.payload;

              if (data && data.donation_count !== undefined) {
                dc.textContent = data.donation_count;
                console.log(
                  `โ [DONATION COUNT] Updated to: ${data.donation_count}`,
                );
              } else {
                console.error("โ [DONATION COUNT] Invalid payload:", payload);
              }
            })
            .subscribe((status) => {
              console.log(`๐ก [DONATION COUNT] Subscription: ${status}`);
            });
        } catch (err) {
          console.error("โ [DONATION COUNT] Failed to load:", err);
          dc.textContent = "Error";
        }
      }

      // ========================================
      // 3. DONATION STATS (Items)
      // ========================================
      async function loadDonationStats() {
        const ds = document.getElementById("donation-stats");
        if (!ds) return;

        // Helper function to render stats
        function renderStats(statsData) {
          if (!statsData?.length) {
            ds.innerHTML =
              '<div class="p-4 text-gray-500 text-center col-span-3">ูุง ุชูุฌุฏ ุจูุงูุงุช</div>';
            return;
          }

          ds.innerHTML = statsData
            .map((row) => {
              const shortageBadge = row.is_in_shortage
                ? `<span class="inline-block bg-red-100 text-red-800 text-xs px-2 py-1 rounded font-bold">โ๏ธ ููุต</span>`
                : "";

              return `
                <div class="bg-white p-6 rounded-xl shadow text-center border-l-4 ${
                  row.is_in_shortage ? "border-red-500" : "border-green-500"
                }">
                  <div class="flex justify-between items-start mb-3">
                    <h4 class="font-bold text-xl text-gray-800">${row.item_ar}</h4>
                    ${shortageBadge}
                  </div>
                  <p class="text-green-700 font-bold text-4xl">${row.quantity}</p>
                  <p class="text-gray-600 mt-1 text-lg">${row.unit_ar || ""}</p>
                </div>
              `;
            })
            .join("");
        }

        try {
          // Load initial data
          const { data, error } = await supabase.rpc("get_donation_stats");
          if (error) throw error;

          renderStats(data);
          console.log(
            "โ [DONATION STATS] Initialized with",
            data?.length || 0,
            "items",
          );

          // Subscribe to dedicated channel
          supabase
            .channel(CHANNELS.DONATION_STATS)
            .on("broadcast", { event: "donation_stats_updated" }, (payload) => {
              console.log("๐ [DONATION STATS] Update received!");
              const data = payload.payload;

              // The SQL now wraps items in an object: { items: [...], timestamp: ... }
              const statsArray = data?.items || data;

              if (Array.isArray(statsArray)) {
                renderStats(statsArray);
                console.log(
                  `โ [DONATION STATS] Updated with ${statsArray.length} items`,
                );
              } else {
                console.error("โ [DONATION STATS] Invalid payload:", payload);
              }
            })
            .subscribe((status) => {
              console.log(`๐ก [DONATION STATS] Subscription: ${status}`);
            });
        } catch (err) {
          console.error("โ [DONATION STATS] Failed to load:", err);
          ds.innerHTML = `<div class="p-4 text-red-500 text-center col-span-3">ุฎุทุฃ: ${err.message}</div>`;
        }
      }

      // ========================================
      // 4. MONEY AMOUNT
      // ========================================
      async function loadMoneyAmount() {
        const ma = document.getElementById("money-amount");

        try {
          // Load initial data
          const { data, error } = await supabase.rpc("get_money_amount");
          if (error) throw error;

          ma.textContent = `${data || 0} ุฏ.ุช`;
          console.log("โ [MONEY] Initialized:", data);

          // Subscribe to dedicated channel
          supabase
            .channel(CHANNELS.MONEY_AMOUNT)
            .on("broadcast", { event: "money_amount_updated" }, (payload) => {
              console.log("๐ [MONEY] Update received!");
              const data = payload.payload;

              if (data && data.amount !== undefined) {
                ma.textContent = `${data.amount} ${data.currency_ar}`;
                console.log(
                  `โ [MONEY] Updated to: ${data.amount} ${data.currency}`,
                );
              } else {
                console.error("โ [MONEY] Invalid payload:", payload);
              }
            })
            .subscribe((status) => {
              console.log(`๐ก [MONEY] Subscription: ${status}`);
            });
        } catch (err) {
          console.error("โ [MONEY] Failed to load:", err);
          ma.textContent = "Error";
        }
      }

      // ========================================
      // DEBUG HELPER
      // ========================================
      window.debugRealtime = () => {
        console.log("๐ ===== REALTIME DEBUG INFO =====");
        console.log("Supabase Client:", supabase);
        console.log("Active Channels:", supabase.getChannels());
        console.log("Channel Configuration:", CHANNELS);
        console.log("=================================");
      };

      // ========================================
      // INITIALIZE ALL
      // ========================================
      console.log("๐ Initializing UGTE Donations Dashboard...");
      console.log("๐ก Channel Configuration:", CHANNELS);

      loadDonorCount();
      loadDonationCount();
      loadDonationStats();
      loadMoneyAmount();

      console.log("โ All loaders initialized!");
      console.log("๐ก Type debugRealtime() in console for debug info");
    </script>
  </body>
</html>
